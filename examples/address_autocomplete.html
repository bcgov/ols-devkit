<!doctype html>
<html lang="en">
<head>
<title>Geocoder Developer Toolkit</title>
<script type="text/javascript">
    unippear({
        "headerContainer": "#chs",
        "footerContainer": "#cfs"
    });
</script>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/themes/smoothness/jquery-ui.css" />
<style>
body {
  color: #333333;
  font-size: 12px;
  font-family: Verdana, Arial, Helvetica, sans-serif;
  margin-top: 5px;
  margin-bottom: 5px;
  margin-left: 20px;
  margin-right: 20px;
}
div.body {
  margin: 0px auto;
  width: 950px;
}
h1 {
  color: #039;
  font-family: Verdana, Arial, Helvetica, sans-serif;
  line-height: 1;
  font-size: 1.6em;
  margin-bottom: 12px;
}

h2 {
  color: #039;
  font-family: Verdana, Arial, Helvetica, sans-serif;
  line-height: 1;
  font-style: italic;
  font-size: 2em;
  margin-bottom: 12px;
}
.spacer {
  margin: 10px;
}
#geocodeField {
  font-family: Verdana, Arial, Helvetica, sans-serif;
  font-size: 1.3em;
  width: 350px;
  border-radius: 4px;
  padding: 0.2em;
}
#output {
  font-family: Menlo, Monaco, Consolas, "Courier New", monospace;
  height: 200px;
  overflow: auto;
  margin: 10px;
  padding: 5px 5px;
  border: 1px solid #ccc;
  border-radius: 4px;
}
</style>
</head>

<body>
<div id="chs"></div>
<div id="main" class="container">
  <h1>Address Autocompletion Example</h1>
  <div id="content">
    <p>This is an example showing how web application developers can incorporate the power of the BC Address Geocoder service into their application easily, including autoComplete functionality.</p>

    <div class="spacer">
      <label for="geocodeField">Enter Address:</label>
      <input type="text" id="geocodeField" placeholder="Type an address" />
      <label for="exactSpelling">
        <input type="checkbox" id="exactSpelling" /> Exact Spelling
      </label>
      <label>
        <input type="checkbox" id="fuzzyMatch"> Fuzzy Match
      </label>	    
    </div>
    <p>Result:</p>
    <pre id="output" aria-live="polite"></pre>

    <h2>Documentation</h2>
	<p>This address auto-completion example makes use of jQuery UI's "autocomplete" function.
	The following stylesheet and scripts must be included in order to use jQuery UI:</p>
	<pre>
		&lt;link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/themes/smoothness/jquery-ui.css" /&gt;
		&lt;script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"&gt;&lt;/script&gt;
		&lt;script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/jquery-ui.min.js"&gt;&lt;/script&gt;
        </pre>
				<p>Next you must include a text input field on your page, which
					you will use for geocoding with auto-completion:</p>
				<pre>
&lt;input type="text" id="geocodeField" placeholder="Type an address" /&gt;
</pre>
				<p>Then you tell jQuery to perform auto-completion on this field,
					and provide it a function which will return a list of potential
					auto-completions for a given input, as well as a function to call
					when one of the suggestions is selected. Below, "geocodeSuggest" uses
					a jQuery ajax call to obtain the potential address matches from the
					geocoder REST API. An in-line function takes the selected suggestion
					and displays the selection's details in formatted JSON text in the result box.</p>
				<pre>
// Geocode Address autocomplete
$('#geocodeField').autocomplete({
	minLength: 3,
	source: geocodeSuggest,
	select: function(evt, ui) {
		$('#output').text(JSON.stringify(ui.item.data, null, 4));
	}
});

// function for suggesting geocode autocompletion options
function geocodeSuggest(request, response, options) {
	var params = {
		minScore: 50,
		maxResults: 5,
		echo: 'false',
		brief: true,
		autoComplete: true,
		addressString: request.term
	};
	$.extend(params, options);
	$.ajax({
		url: gcApi + "addresses.json",
		data: params,
		success: function(data) {
			var list = [];
			if(data.features && data.features.length > 0) {
				list = data.features.map( function(item) {
					return {
						value: item.properties.fullAddress,
						data: item
					}
				});
			}
			response(list);
		},
		error: function() {
			response([]);
		}
	});
}
    </pre>
    <p>For further information on jQuery UI's Autocomplete function, see the
      <a href="https://jqueryui.com/autocomplete/">jQuery Documentation</a>.</p>
    <p>Here is a description of the options which can be used to configure the results returned by the REST API and address autoComplete suggestions:</p>
    <ul>
        <li><a href="https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#autoComplete">autoComplete</a></li>
	<li><a href="https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#brief">brief</a></li>
	<li><a href="https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#echo">echo</a></li>
	<li><a href="https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#maxResults">maxResults</a></li>
	<li><a href="https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#minScore">minScore</a></li>
	<li><a href="https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#outputSRS">outputSRS</a></li>
	<li><a href="https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#setBack">setBack</a></li>
	<li><a href="https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#interpolation">interpolation</a></li>
	<li><a href="https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#locationDescriptor">locationDescriptor</a></li>
	<li><a href="https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#bbox">bbox</a></li>
	<li><a href="https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#centre">centre</a></li>
	<li><a href="https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#maxDistance">maxDistance</a></li>
	<li><a href="https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#localities">localities</a></li>
	<li><a href="https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#localitiesNot">localitiesNot</a></li>
	<li><a href="https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#matchPrecision">matchPrecision</a></li>
	<li><a href="https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#matchPrecisionNot">matchPrecisionNot</a></li>
    </ul>
    <p>For more information on these geocoder parameters, see the
      <a href="https://openapi.apps.gov.bc.ca/?url=https://raw.githubusercontent.com/bcgov/api-specs/master/geocoder/geocoder-combined.json">REST API Console</a>.</p>
  </div>
</div>
	
<div id="cfs"></div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/jquery-ui.min.js"></script>
<script>
var gcApi = "https://geocoder.api.gov.bc.ca/";

// Geocode Address autocomplete
$('#geocodeField').autocomplete({
  minLength: 3,
  source: geocodeSuggest,
  select: function(evt, ui) {
    $('#output').text(JSON.stringify(ui.item.data, null, 4));
  }
});

// reusable function for suggesting geocode autocompletion options
function geocodeSuggest(request, response, options) {
  var params = {
    addressString: request.term,
    maxResults: 5,
    minScore: 50,
    echo: false,
    brief: true,
    autoComplete: true,
    exactSpelling: $('#exactSpelling').is(':checked'),
    fuzzyMatch: $('#fuzzyMatch').is(':checked')
  };

  $.extend(params, options);
  $.ajax({
    url: gcApi + "addresses.json",
    data: params,
    success: function(data) {
      var list = [];
      if (data.features && data.features.length > 0) {
        list = data.features.map(function(item) {
          return {
            value: item.properties.fullAddress,
            data: item
          };
        });
      }
      response(list);
    },
    error: function() {
      response([]);
    }
  });
}
</script>
</body>
</html>
