<!doctype html>
<html lang="en">
<head>
<title>Geocoder Developer Toolkit</title>
<script type="text/javascript">
    unippear({
        "headerContainer": "#chs",
        "footerContainer": "#cfs"
    });
</script>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/themes/smoothness/jquery-ui.css" />
<style>
body {
  color: #333333;
  font-size: 12px;
  font-family: Verdana, Arial, Helvetica, sans-serif;
  margin: 0px;
}
div.body {
  margin: 0px auto;
  width: 950px;
}
h1 {
  color: #039;
  font-family: Verdana, Arial, Helvetica, sans-serif;
  line-height: 1;
  font-size: 1.6em;
  margin-bottom: 12px;
}

h2 {
  color: #039;
  font-family: Verdana, Arial, Helvetica, sans-serif;
  line-height: 1;
  font-style: italic;
  font-size: 2em;
  margin-bottom: 12px;
}
.spacer {
  margin: 10px;
}
#geocodeField {
  font-family: Verdana, Arial, Helvetica, sans-serif;
  font-size: 1.3em;
  width: 350px;
  border-radius: 4px;
  padding: 0.2em;
}
#output {
  font-family: Menlo, Monaco, Consolas, "Courier New", monospace;
  height: 200px;
  overflow: auto;
  margin: 10px;
  padding: 5px 5px;
  border: 1px solid #ccc;
  border-radius: 4px;
}
</style>
</head>

<body>
<div id="chs"></div>
<div id="main" class="body">
  <h1>Address Autocompletion Example</h1>
  <div id="content">
    <div>This is an example showing how web application developers can
      incorporate the power of the BC Physical Address Geocoder service into their application easily, including advanced auto-complete functionality.</div>

    <div class="spacer">
      <input type="text" id="geocodeField" placeholder="Type an address" />
      <label>
        <input type="checkbox" id="exactSpelling" /> Exact Spelling
      </label>
    </div>
    Result:
    <pre id="output"></pre>

    <h2>Documentation</h2>
				<p>For further information on jQuery UI's Autocomplete function, see the
					<a href="https://jqueryui.com/autocomplete/">jQuery Documentation</a>.</p>
				<p>There are various options available, set using the "params" variable in the geocodeSuggest function.
					Here is a description of the options which can be used to configure the results returned by the
					REST API and address auto-completion suggestions</p>
					<h4>[autoComplete](https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#autoComplete)</h4>
					<h4>[brief](https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#brief)</h4>
					<h4>[echo](https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#echo)</h4>
					<h4>[maxResults](https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#maxResults)</h4>
					<h4>[minScore](https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#minScore)</h4>
					<h4>[outputSRS](https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#outputSRS)</h4>
					<h4>[setBack](https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#setBack)</h4>
					<h4>[interpolation](https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#interpolation)</h4>
					<h4>[locationDescriptor](https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#locationDescriptor)</h4>
					<h4>[bbox](https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#bbox)</h4>
					<h4>[centre](https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#centre)</h4>
					<h4>[maxDistance](https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#maxDistance)</h4>
					<h4>[localities](https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#localities)</h4>
	  				<h4>[localitiesNot](https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#localitiesNot)</h4>
	  				<h4>[matchPrecision](https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#matchPrecision)</h4>
	  				<h4>[matchPrecisionNot](https://github.com/bcgov/ols-geocoder/blob/gh-pages/glossary.md#matchPrecisionNot)</h4>

				<p>For more information on these geocoder parameters, see the
					<a href="https://openapi.apps.gov.bc.ca/?url=https://raw.githubusercontent.com/bcgov/api-specs/master/geocoder/geocoder-combined.json">REST API
						Console</a>
  </div>
</div>
<div id="cfs"></div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/jquery-ui.min.js"></script>
<script>
var gcApi = "https://geocoder.api.gov.bc.ca/";

// Geocode Address autocomplete
$('#geocodeField').autocomplete({
  minLength: 3,
  source: geocodeSuggest,
  select: function(evt, ui) {
    $('#output').text(JSON.stringify(ui.item.data, null, 4));
  }
});

// reusable function for suggesting geocode autocompletion options
function geocodeSuggest(request, response, options) {
  var params = {
    minScore: 50,
    maxResults: 5,
    echo: false,
    brief: true,
    autoComplete: true,
    exactSpelling: $('#exactSpelling').is(':checked'),
    addressString: request.term
  };

  $.extend(params, options);
  $.ajax({
    url: gcApi + "addresses.json",
    data: params,
    success: function(data) {
      var list = [];
      if (data.features && data.features.length > 0) {
        list = data.features.map(function(item) {
          return {
            value: item.properties.fullAddress,
            data: item
          };
        });
      }
      response(list);
    },
    error: function() {
      response([]);
    }
  });
}
</script>
</body>
</html>
