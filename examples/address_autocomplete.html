<!doctype html>
<html lang="en">
<head>
<title>Geocoder Developer Toolkit</title>
<script type="text/javascript">
    unippear({
        "headerContainer": "#chs",
        "footerContainer": "#cfs"
    });
</script>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/themes/smoothness/jquery-ui.css" />
<style>
body {
  color: #333333;
  font-size: 12px;
  font-family: Verdana, Arial, Helvetica, sans-serif;
  margin: 0px;
}
div.body {
  margin: 0px auto;
  width: 950px;
}
h1 {
  color: #039;
  font-family: Verdana, Arial, Helvetica, sans-serif;
  line-height: 1;
  font-size: 1.6em;
  margin-bottom: 12px;
}

h2 {
  color: #039;
  font-family: Verdana, Arial, Helvetica, sans-serif;
  line-height: 1;
  font-style: italic;
  font-size: 2em;
  margin-bottom: 12px;
}
.spacer {
  margin: 10px;
}
#geocodeField {
  font-family: Verdana, Arial, Helvetica, sans-serif;
  font-size: 1.3em;
  width: 350px;
  border-radius: 4px;
  padding: 0.2em;
}
#output {
  font-family: Menlo, Monaco, Consolas, "Courier New", monospace;
  height: 200px;
  overflow: auto;
  margin: 10px;
  padding: 5px 5px;
  border: 1px solid #ccc;
  border-radius: 4px;
}
</style>
</head>

<body>
<div id="chs"></div>
<div id="main" class="body">
  <h1>Address Autocompletion Example</h1>
  <div id="content">
    <div>This is an example showing how web application developers can
      incorporate the power of the BC Physical Address Geocoder service into their application easily, including advanced auto-complete functionality.</div>

    <div class="spacer">
      <input type="text" id="geocodeField" placeholder="Type an address" />
      <label>
        <input type="checkbox" id="exactSpelling" /> Exact Spelling
      </label>
    </div>
    Result:
    <pre id="output"></pre>

    <h2>Documentation</h2>
    <p>For further information on jQuery UI's Autocomplete function, see the
      <a href="https://jqueryui.com/autocomplete/">jQuery Documentation</a>.</p>

  </div>
</div>
<div id="cfs"></div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/jquery-ui.min.js"></script>
<script>
var gcApi = "https://geocoder.api.gov.bc.ca/";

// Geocode Address autocomplete
$('#geocodeField').autocomplete({
  minLength: 3,
  source: geocodeSuggest,
  select: function(evt, ui) {
    $('#output').text(JSON.stringify(ui.item.data, null, 4));
  }
});

// reusable function for suggesting geocode autocompletion options
function geocodeSuggest(request, response, options) {
  var params = {
    minScore: 50,
    maxResults: 5,
    echo: 'false',
    brief: true,
    autoComplete: true,
    addressString: request.term
  };

  // Check the exact spelling checkbox state
  var exactSpelling = $('#exactSpelling').is(':checked');
  params.exactSpelling = exactSpelling;

  $.extend(params, options);
  $.ajax({
    url: gcApi + "addresses.json",
    data: params,
    success: function(data) {
      var list = [];
      if (data.features && data.features.length > 0) {
        list = data.features.map(function(item) {
          return {
            value: item.properties.fullAddress,
            data: item
          };
        });
      }
      response(list);
    },
    error: function() {
      response([]);
    }
  });
}
</script>
</body>
</html>
